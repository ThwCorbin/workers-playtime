<!DOCTYPE html>
<html>
	<head>
		<title>Monsters Behind Doors!</title>

		<style type="text/css">
			body {
				margin: 1em auto;
				max-width: 40em;
				width: 88%;
				text-align: center;
				font-family: Impact, Haettenschweiler, "Arial Narrow Bold", sans-serif;
				color: mediumslateblue;
			}

			/* A simple grid layout */
			.row {
				display: grid;
				grid-template-columns: auto auto auto;
				text-align: center;
			}

			.grid {
				min-height: 6em;
				padding: 1em;
			}

			/* Make sure images scale */
			img {
				height: auto;
				max-width: 100%;
			}
		</style>
	</head>
	<body>
		<h1>Monsters Behind Doors!</h1>
		<div id="app" class="row"></div>

		<footer>
			<hr />
			<p class="text-small text-muted">
				Icons by
				<a href="https://thenounproject.com/term/door/311732/"
					>Jamie Dickinson</a
				>,
				<a href="https://thenounproject.com/term/monster/184225/"
					>Nicky Knicky</a
				>,
				<a href="https://thenounproject.com/term/monster/1510400/"
					>Alvaro Cabrera</a
				>,
				<a href="https://thenounproject.com/term/monster/28460/">Eliricon</a>,
				<a href="https://thenounproject.com/term/monster/82823/">April Yang</a>,
				<a href="https://thenounproject.com/term/monster/1062009/">tk66</a>,
				<a href="https://thenounproject.com/term/monster/24990/">Alex WaZa</a>,
				<a href="https://thenounproject.com/term/monster/37212/">Husein Aziz</a
				>,
				<a href="https://thenounproject.com/term/monster/2236082">iconcheese</a
				>, and
				<a href="https://thenounproject.com/term/socks/38451/">Yazmin Alanis</a
				>.
			</p>
		</footer>

		<script>
			/**
			 * Element.closest() polyfill
			 * https://developer.mozilla.org/en-US/docs/Web/API/Element/closest#Polyfill
			 */
			if (!Element.prototype.closest) {
				if (!Element.prototype.matches) {
					Element.prototype.matches =
						Element.prototype.msMatchesSelector ||
						Element.prototype.webkitMatchesSelector;
				}
				Element.prototype.closest = function (s) {
					var el = this;
					var ancestor = this;
					if (!document.documentElement.contains(el)) return null;
					do {
						if (ancestor.matches(s)) return ancestor;
						ancestor = ancestor.parentElement;
					} while (ancestor !== null);
					return null;
				};
			}

			// Selectors
			let app = document.querySelector("#app");

			// Array of monsters and a sock
			let monsters = [
				"monster1",
				"monster2",
				"monster3",
				"monster4",
				"monster5",
				"monster6",
				"monster7",
				"monster8",
				"monster9",
				"monster10",
				"monster11",
				"sock",
			];

			// Hide door and show monster image
			// If image is sock, end game and reset
			const showImage = (e) => {
				// If the target is the door image
				if (e.target.className === "door") {
					e.target.setAttribute("hidden", true);
					// Reset...
					if (e.target.nextElementSibling.id === "sock") {
						e.target.nextElementSibling.removeAttribute("hidden");
						alert("Sock!");
						buildHTML();
						return;
					}
					// ...or continue game
					e.target.nextElementSibling.removeAttribute("hidden");
					// If the target is the button parent element
				} else if (e.target.className.includes("show-img")) {
					e.target.firstElementChild.setAttribute("hidden", true);
					// Reset...
					if (e.target.lastElementChild.id === "sock") {
					e.target.lastElementChild.removeAttribute("hidden");
					alert("Sock!");
					buildHTML();
					return;
					}
					// ...or continue game
					e.target.lastElementChild.removeAttribute("hidden");
				} else {
					// The target is not a door image nor a button
					return;
				}
			};

			// Fisherâ€“Yates Shuffle function adapted from a card game I'm working on
			// https://www.thwcorbin.com/posts/shuffle-card-deck/
			const shuffle = (array) => {
				// Set initial number of unshuffled elements & random element
				let unshuffledElements = array.length; // Number to decrement
				let randomElement = null; // Number for random index

				// While unshuffled elements remain
				while (unshuffledElements) {
					// Pick random number betweeen 0 inclusive and number of unshuffled elements
					// Then decrement the number of unshuffled elements by 1
					randomElement = Math.floor(Math.random() * unshuffledElements--);
					// Array destructuring: Swap the random element with the last unshuffled element in the array
					[array[randomElement], array[unshuffledElements]] = [
						array[unshuffledElements],
						array[randomElement],
					];
				}
				return array;
			};

			// Build html to display monster images
			const buildHTML = () => {
				let html = "";
				let imgUrl =
					"https://raw.githubusercontent.com/gist/cferdinandi/b216c6c06685a381ec5bd547410d76c1/raw/ea404869e2c3b02738b36ccb9d82921f80cbf2bd/";
				// Shuffle the array
				shuffle(monsters);
				// Build string of divs containing images
				monsters.forEach((element) => {
					html += `<button class="grid show-img" aria-live="polite">
										<img class="door" src="${imgUrl}door.svg" alt="door">
										<img id="${element}" src="${imgUrl}${element}.svg" alt="${element}" hidden>
									</button>`;
				});
				// Update the DOM
				app.innerHTML = html;
			};

			// document.addEventListener("click", (e) => {
			// 	if(e.target.closest(".show-img")) showImage(e);
			// });
			document.addEventListener("click", showImage);
			document.addEventListener("load", buildHTML());
		</script>
	</body>
</html>
